<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title | default: site.title }}</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root {
      /* Color Palette */
      --panel-bg-dark: #333;
      --text-color-light: #f0f0f0;
      --link-color-light: #7fdbff;
      --link-hover-light: #aaddff;
      --icon-color-light: #ccc;
      --icon-hover-light: #fff;
      --content-bg: #fff;
      --content-text: #333;

      /* Layout */
      --mobile-breakpoint: 768px;
      --sidebar-width-large: 350px;
      --sidebar-width-standard: 250px;
      --sidebar-width-collapsed: 75px;
      --collapsed-image-size: 45px;
      --mobile-top-bar-height: 55px; /* Approximate height for padding */
      --transition-speed: 0.3s;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      min-height: 100vh;
      flex-direction: row;
      background-color: var(--content-bg);
      color: var(--content-text);
      transition: padding-left var(--transition-speed) ease;
    }

    /* --- Sidebar (Common & Desktop) --- */
    .sidebar {
      background-color: var(--panel-bg-dark);
      color: var(--text-color-light);
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.2);
      text-align: center;
      flex-shrink: 0;
      overflow-x: hidden; /* Prevent horizontal scroll */
      overflow-y: auto;   /* Allow vertical scroll if needed */
      transition: width var(--transition-speed) ease, padding var(--transition-speed) ease;
      z-index: 1000; /* Base z-index for desktop */
      position: relative;
      box-sizing: border-box;
      height: 100vh; /* Make sidebar full height on desktop */
      position: sticky; /* Stick to top on desktop */
      top: 0;
    }
    .sidebar-large-page { width: var(--sidebar-width-large); }
    .sidebar-standard-page { width: var(--sidebar-width-standard); }

    .sidebar.collapsed { /* Desktop collapsed state */
      width: var(--sidebar-width-collapsed);
      padding: 10px;
      padding-top: 70px; /* Space for desktop toggle + image */
    }
    .sidebar.collapsed .sidebar-profile-pic { /* Target specific image class */
      display: block !important;
      max-width: var(--collapsed-image-size) !important;
      height: var(--collapsed-image-size);
      margin: 15px auto;
      opacity: 1 !important;
      object-fit: cover;
    }
    .sidebar.collapsed h2,
    .sidebar.collapsed .sidebar-description { /* Target specific description class */
      display: none;
    }
    .sidebar.collapsed .sidebar-icon-links { /* Target specific icon class */
      margin-top: 20px;
    }
     .sidebar.collapsed .sidebar-icon-links a {
       font-size: 24px;
       margin: 10px 0;
       display: block;
     }

    .sidebar-profile-pic { /* Class for the main profile pic */
      max-width: 150px;
      height: auto;
      border-radius: 50%;
      margin-bottom: 15px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: opacity var(--transition-speed) ease, max-width var(--transition-speed) ease, height var(--transition-speed) ease;
    }
    .sidebar h2 { margin-top: 0; font-size: 1.5em; transition: opacity var(--transition-speed) ease; }
    .sidebar-description { /* Class for description */
      font-size: 0.95em;
      line-height: 1.4;
      text-align: justify;
      transition: opacity var(--transition-speed) ease;
    }
    .sidebar a { color: var(--link-color-light); text-decoration: none; }
    .sidebar a:hover { text-decoration: underline; color: var(--link-hover-light); }
    .sidebar-icon-links { margin-top: 15px; } /* Class for main icons */
    .sidebar-icon-links a { margin: 0 8px; display: inline-block; color: var(--icon-color-light); font-size: 20px; transition: color 0.2s ease; }
    .sidebar-icon-links a:hover { color: var(--icon-hover-light); }

    /* --- Desktop Toggle Button --- */
    #desktop-sidebar-toggle {
      display: none; /* Hidden by default, shown on desktop */
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color-light);
      border: none; width: 40px; height: 40px; font-size: 1.2em;
      cursor: pointer; z-index: 1001; border-radius: 4px;
      align-items: center; justify-content: center;
      transition: background-color 0.2s ease;
    }
    #desktop-sidebar-toggle:hover { background: rgba(255, 255, 255, 0.2); }
    .sidebar.collapsed #desktop-sidebar-toggle { /* Position when collapsed */
       left: calc( (var(--sidebar-width-collapsed) - 40px) / 2 );
       top: 15px;
    }

    /* --- Mobile-Only Top Bar --- */
    #mobile-top-bar {
        display: none; /* Hidden by default */
        background-color: var(--panel-bg-dark);
        color: var(--text-color-light);
        padding: 5px 15px;
        position: sticky; /* Stick to top on mobile scroll */
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1005; /* Above content, below overlay & sidebar */
        box-sizing: border-box;
        align-items: center;
        min-height: var(--mobile-top-bar-height);
    }
    #mobile-sidebar-toggle { /* The hamburger button in the mobile top bar */
        background: none;
        border: none;
        color: var(--text-color-light);
        font-size: 1.8em; /* Larger icon */
        cursor: pointer;
        padding: 5px;
        margin-right: 15px; /* Space between button and pic */
        line-height: 1; /* Prevent extra spacing */
    }
    .mobile-top-profile-pic {
        height: 35px;
        width: 35px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: auto; /* Push icons to the right */
    }
    .mobile-top-icons {
        display: flex;
        align-items: center;
    }
    .mobile-top-icons a {
        color: var(--icon-color-light);
        font-size: 20px; /* Adjust size as needed */
        margin-left: 12px; /* Space between icons */
        transition: color 0.2s ease;
    }
    .mobile-top-icons a:hover {
        color: var(--icon-hover-light);
    }

    /* --- Close button inside the slide-out sidebar (Mobile only) --- */
    #sidebar-close-button {
        display: none; /* Hidden by default */
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        color: var(--text-color-light);
        font-size: 1.8em;
        cursor: pointer;
        z-index: 1011; /* Ensure it's above the sidebar background (1010) */
    }

    /* --- Main Content Area --- */
    .content-wrapper {
      flex-grow: 1; display: flex; flex-direction: column;
      min-width: 0; /* Prevent flex item overflow */
      transition: margin-left var(--transition-speed) ease;
      width: 100%; /* Ensure it takes up space */
    }
    nav {
      background-color: var(--panel-bg-dark); color: var(--text-color-light);
      padding: 10px 20px; text-align: center; border-bottom: 1px solid #555;
      flex-shrink: 0;
    }
    nav a { margin: 0 15px; text-decoration: none; color: var(--text-color-light); font-weight: bold; display: inline-block; padding: 5px 0; transition: color 0.2s ease; }
    nav a:hover { color: var(--link-color-light); }
    main { padding: 30px; flex-grow: 1; background-color: var(--content-bg); color: var(--content-text); }


    /* --- Responsive Styles --- */
    @media (min-width: 769px) { /* Apply desktop styles above breakpoint */
        /* Show desktop toggle button on larger screens */
        #desktop-sidebar-toggle {
            display: flex; /* Use flex to center icon */
        }
        /* Ensure mobile top bar is hidden on desktop */
        #mobile-top-bar {
            display: none !important;
        }
    }

    @media (max-width: 768px) { /* Apply mobile styles at or below breakpoint */
      body {
        flex-direction: column;
        /* Add padding to prevent content from going under sticky top bar */
        /* Padding is applied dynamically via JS now, but keep this as fallback or if JS fails */
         padding-top: var(--mobile-top-bar-height);
      }

      /* Hide desktop sidebar structure */
      .sidebar {
        position: fixed; /* Change from sticky to fixed */
        top: 0; left: 0; height: 100%;
        background-color: var(--panel-bg-dark); /* Explicit background */
        width: 80%; max-width: 300px;
        transform: translateX(-100%); /* Hidden off-screen */
        transition: transform var(--transition-speed) ease;
        box-shadow: 2px 0 5px rgba(0,0,0,0.3);
        overflow-y: auto; display: block;
        padding-top: 50px; /* Space for close button */
        z-index: 1010; /* *** FIX: Ensure sidebar is above top-bar (1005) *** */
        /* Override desktop collapsed state visually & ensure correct width */
        width: min(80%, 300px) !important;
        padding-left: 20px !important; padding-right: 20px !important;
        /* Reset desktop specific styles that might interfere */
        padding-top: 50px !important;
      }

      /* Show Mobile Top Bar */
      #mobile-top-bar {
          display: flex; /* Use flex for layout */
      }

      /* Hide Desktop Toggle */
      #desktop-sidebar-toggle { display: none !important; }


      .sidebar:not(.collapsed) {
         transform: translateX(0); /* Slide in */
      }
      /* Ensure content is visible when sidebar is open on mobile */
      .sidebar .sidebar-profile-pic,
      .sidebar h2,
      .sidebar .sidebar-description {
        display: block !important; opacity: 1 !important;
      }
      .sidebar .sidebar-profile-pic { /* Restore image size */
          max-width: 120px !important; height: auto !important;
          margin: 15px auto !important; /* Restore margin */
      }
      .sidebar .sidebar-icon-links { margin-top: 15px !important; }
      .sidebar .sidebar-icon-links a { /* Restore icon layout */
         font-size: 22px !important; margin: 0 10px !important; display: inline-block !important;
      }
      /* Show close button only when sidebar is open on mobile */
      .sidebar:not(.collapsed) #sidebar-close-button {
          display: block;
      }

      /* Content wrapper takes full width */
      .content-wrapper { margin-left: 0 !important; width: 100%; }
      nav { /* Ensure nav is full width */ width: 100%; box-sizing: border-box; }

      /* Mobile Overlay */
      body::after {
         content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
         background: rgba(0, 0, 0, 0.6); z-index: 999; /* Below sidebar and top bar */
         opacity: 0; visibility: hidden;
         transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
      }
      body.sidebar-open::after { opacity: 1; visibility: visible; }
    }

  </style>
</head>
<body class="{% if page.homepage %}homepage-body{% else %}standard-body{% endif %}"> <!-- Optional: Add body class -->

  <!-- Mobile Only Top Bar -->
  <div id="mobile-top-bar">
      <button id="mobile-sidebar-toggle" aria-label="Open Menu" aria-controls="sidebar" aria-expanded="false">
          <i class="fas fa-bars"></i>
      </button>
      <img src="{{ site.baseurl | default: '' }}/assets/profile.jpg" alt="Shubham" class="mobile-top-profile-pic">
      <div class="mobile-top-icons">
          <!-- Duplicated Icons for Mobile Top Bar -->
          <a href="https://github.com/perturber" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
          <a href="https://orcid.org/0009-0004-5838-1886" target="_blank" title="ORCID"><i class="fab fa-orcid"></i></a>
          <a href="mailto:shubhamkejriwal@u.nus.edu" title="Email"><i class="fas fa-envelope"></i></a>
          <a href="https://www.linkedin.com/in/shubham-kejriwal-919976192/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
      </div>
  </div>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar {% if page.homepage %}sidebar-large-page{% else %}sidebar-standard-page{% endif %}">
    <!-- Desktop Toggle Button (Positioned absolutely within sidebar) -->
    <button id="desktop-sidebar-toggle" aria-label="Toggle Menu" aria-controls="sidebar" aria-expanded="true">
      <i class="fas fa-times"></i> <!-- Starts 'close' icon as sidebar open by default -->
    </button>
    <!-- Mobile Close Button (Positioned absolutely within sidebar) -->
    <button id="sidebar-close-button" aria-label="Close Menu">
        <i class="fas fa-times"></i>
    </button>

    <!-- Sidebar Content -->
    <img src="{{ site.baseurl | default: '' }}/assets/profile.jpg" alt="Shubham" class="sidebar-profile-pic">
    <h2>Shubham Kejriwal</h2>
    <p class="sidebar-description"><strong>Ph.D. Physics</strong> <br>National University of Singapore <br>
Science Drive 4, <br> Singapore-119077 </p>
    <div class="sidebar-icon-links">
      <a href="https://github.com/perturber" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
      <a href="https://orcid.org/0009-0004-5838-1886" target="_blank" title="ORCID"><i class="fab fa-orcid"></i></a>
      <a href="mailto:shubhamkejriwal@u.nus.edu" title="Email"><i class="fas fa-envelope"></i></a>
      <a href="https://www.linkedin.com/in/shubham-kejriwal-919976192/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <nav>
      <a href="{{ site.baseurl | default: '' }}/">Home</a>
      <a href="{{ site.baseurl | default: '' }}/research/">Research</a>
      <a href="{{ site.baseurl | default: '' }}/publications/">Publications</a>
      <a href="{{ site.baseurl | default: '' }}/teaching/">Teaching & Mentoring</a>
    </nav>
    <main>
      {{ content }}
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sidebar = document.getElementById("sidebar");
      const body = document.body;
      const mobileTopBar = document.getElementById("mobile-top-bar"); // Get ref to top bar

      // --- Button References ---
      const desktopToggleBtn = document.getElementById("desktop-sidebar-toggle");
      const mobileToggleBtn = document.getElementById("mobile-sidebar-toggle");
      const sidebarCloseBtn = document.getElementById("sidebar-close-button");

      // --- Error Checking ---
      if (!sidebar) { console.error("Sidebar element not found."); return; }
      if (!mobileTopBar) { console.error("Mobile top bar element not found."); return; }
      if (!desktopToggleBtn) { console.error("Desktop toggle button not found."); return; }
      if (!mobileToggleBtn) { console.error("Mobile toggle button not found."); return; }
      if (!sidebarCloseBtn) { console.error("Sidebar close button not found."); return; }

      // --- Dynamic Padding Helper ---
      // Calculates height of mobile top bar if visible and applies padding to body
      const adjustBodyPadding = () => {
          const isMobile = window.innerWidth <= 768;
          if (isMobile && mobileTopBar.offsetHeight > 0) {
              body.style.paddingTop = `${mobileTopBar.offsetHeight}px`;
          } else {
              body.style.paddingTop = '0px'; // Remove padding on desktop or if bar hidden
          }
      };


      // --- Helper Function to Manage State ---
      const setSidebarState = (isCollapsed) => {
          sidebar.classList.toggle('collapsed', isCollapsed);
          const isMobile = window.innerWidth <= 768;
          body.classList.toggle('sidebar-open', !isCollapsed && isMobile); // Overlay only on mobile

          // Update ARIA attributes and icons
          if (isMobile) {
              mobileToggleBtn.setAttribute('aria-expanded', !isCollapsed);
              // Mobile hamburger icon doesn't need to change, only open/close buttons
          } else {
              desktopToggleBtn.setAttribute('aria-expanded', !isCollapsed);
              const desktopIcon = desktopToggleBtn.querySelector('i');
              if (desktopIcon) {
                  desktopIcon.className = isCollapsed ? 'fas fa-bars' : 'fas fa-times';
              }
          }
          // Adjust body padding after state change (sidebar visibility might affect layout briefly)
          requestAnimationFrame(adjustBodyPadding);
      };

      // --- Initial State & Padding---
      let isInitiallyCollapsed = window.innerWidth <= 768; // Start collapsed on mobile, open on desktop
      setSidebarState(isInitiallyCollapsed); // Apply initial state
      adjustBodyPadding(); // Set initial padding


      // --- Event Listeners ---
      desktopToggleBtn.addEventListener("click", function () {
          setSidebarState(sidebar.classList.toggle("collapsed"));
      });

      mobileToggleBtn.addEventListener("click", function () {
          setSidebarState(false); // Force open
      });

      sidebarCloseBtn.addEventListener("click", function () {
          setSidebarState(true); // Force close
      });

      body.addEventListener('click', function(event) {
           if (window.innerWidth <= 768 && body.classList.contains('sidebar-open')) {
               // Close if click is outside sidebar AND outside mobile toggle button
               if (!sidebar.contains(event.target) && !mobileToggleBtn.contains(event.target)) {
                   setSidebarState(true);
               }
           }
       });

      // --- Resize Handling ---
      let currentWindowWidth = window.innerWidth;
      window.addEventListener('resize', function() {
          adjustBodyPadding(); // Recalculate padding on resize
          const newWindowWidth = window.innerWidth;
          const breakpoint = 768;
          const isMobile = newWindowWidth <= breakpoint;
          const wasMobile = currentWindowWidth <= breakpoint;

          if (isMobile !== wasMobile) { // Crossed the breakpoint
              let shouldBeCollapsed = isMobile; // Default: Collapse on mobile, open on desktop
              setSidebarState(shouldBeCollapsed);
          }
          currentWindowWidth = newWindowWidth;
      });

      // Also adjust padding on orientation change
      window.addEventListener('orientationchange', adjustBodyPadding);
    });
  </script>

</body>
</html>
